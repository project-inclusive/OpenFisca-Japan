# 計算式が複雑なため、計算式に登場する各控除については決め打ちの値でテスト（各控除の算出についてはそれぞれの単体テストで担保）

# NOTE: 条件的に同時に受けられない控除があるためテストケース分割
- name: 人的控除額の差（差額通りの控除1）
  period: 2023-06-01
  input:
    世帯:
      障害者控除: 270000
      住民税障害者控除: 260000 # 差額 10000
      勤労学生控除: 270000
      住民税勤労学生控除: 260000 # 差額 10000
      配偶者控除: 380000
      住民税配偶者控除: 330000 # 差額 50000
      扶養控除: 380000
      住民税扶養控除: 330000 # 差額 50000
      自分一覧:
        - 自分
      配偶者一覧:
        - 配偶者1
      子一覧:
        - 子1
    世帯員:
      自分:
        所得:
          "2023-06-01": 100000
        誕生年月日: "1983-01-01"
      配偶者1:
        所得:
          "2023-06-01": 0
        誕生年月日: "1983-01-01"
      子1:
        所得:
          "2023-06-01": 10000
        誕生年月日: "2023-01-01"
  output:
    世帯:
      人的控除額の差:
        "2023-06-01": 170000 # 所得税控除と住民税控除の差額(10000 + 10000 + 50000 + 50000) + 基礎控除の差額(50000)

- name: 人的控除額の差（差額通りの控除2）
  period: 2023-06-01
  input:
    世帯:
      配偶者特別控除: 380000
      住民税配偶者特別控除: 330000 # 差額 50000
      自分一覧:
        - 自分
      配偶者一覧:
        - 配偶者1
    世帯員:
      自分:
        所得:
          "2023-06-01": 1000000
        誕生年月日: "1983-01-01"
      配偶者1:
        所得:
          "2023-06-01": 490000
        誕生年月日: "2023-01-01"
  output:
    世帯:
      人的控除額の差:
        "2023-06-01": 100000 # 所得税控除と住民税控除の差額(50000) + 基礎控除の差額(50000)

- name: 人的控除額の差（差額通りの控除3）
  period: 2023-06-01
  input:
    世帯:
      寡婦控除: 270000
      住民税寡婦控除: 260000 # 差額 10000
      ひとり親控除: 350000
      住民税ひとり親控除: 300000 # 差額 50000
      自分一覧:
        - 自分
      子一覧:
        - 子1
    世帯員:
      自分:
        所得:
          "2023-06-01": 0
        誕生年月日: "1983-01-01"
      子1:
        所得:
          "2023-06-01": 0
        誕生年月日: "2023-01-01"
  output:
    世帯:
      人的控除額の差:
        "2023-06-01": 110000 # 所得税控除と住民税控除の差額(10000 + 50000) + 基礎控除の差額(50000)

# 例外的な計算式の場合

- name: 人的控除額の差(ひとり親、父親)
  period: 2023-06-01
  input:
    世帯:
      ひとり親控除: 350000
      住民税ひとり親控除: 300000 # 差額 50000 (例外的に10000円で計算)
      自分一覧:
        - 自分
      子一覧:
        - 子1
    世帯員:
      自分:
        所得:
          "2023-06-01": 0
        性別:
          "2023-06-01": 男性
        誕生年月日: "1983-01-01"
      子1:
        所得:
          "2023-06-01": 0
        誕生年月日: "2023-01-01"
  output:
    世帯:
      人的控除額の差:
        "2023-06-01": 60000 # 所得税控除と住民税控除の差額(10000) + 基礎控除の差額(50000)

- name: 人的控除額の差（ひとり親、母親）
  period: 2023-06-01
  input:
    世帯:
      寡婦控除: 270000
      住民税寡婦控除: 260000 # 差額 10000
      ひとり親控除: 350000
      住民税ひとり親控除: 300000 # 差額 50000
      自分一覧:
        - 自分
      子一覧:
        - 子1
    世帯員:
      自分:
        所得:
          "2023-06-01": 0
        性別:
          "2023-06-01": 女性
        誕生年月日: "1983-01-01"
      子1:
        所得:
          "2023-06-01": 0
        誕生年月日: "2023-01-01"
  output:
    世帯:
      人的控除額の差:
        "2023-06-01": 110000 # 所得税控除と住民税控除の差額(10000 + 50000) + 基礎控除の差額(50000)

- name: 人的控除額の差（基礎控除の差額が50000円扱い）
  period: 2023-06-01
  input:
    世帯:
      自分一覧:
        - 自分
      配偶者一覧:
        - 配偶者1
    世帯員:
      自分:
        所得:
          "2023-06-01": 25000000
        誕生年月日: "1983-01-01"
      配偶者1:
        所得:
          "2023-06-01": 5000000
        誕生年月日: "1983-01-01"
  output:
    世帯:
      人的控除額の差:
        "2023-06-01": 50000 # 基礎控除の差額(50000)

- name: 人的控除額の差（基礎控除の差額が0円扱い）
  period: 2023-06-01
  input:
    世帯:
      自分一覧:
        - 自分
      配偶者一覧:
        - 配偶者1
    世帯員:
      自分:
        所得:
          "2023-06-01": 25000002 # NOTE: float32の丸め誤差で 25000001円は25000000円になってしまう
        誕生年月日: "1983-01-01"
      配偶者1:
        所得:
          "2023-06-01": 5000000
        誕生年月日: "1983-01-01"
  output:
    世帯:
      人的控除額の差:
        "2023-06-01": 0

# 調整控除
- name: 調整控除（控除後世帯高所得が2000000円以下）
  period: 2023-06-01
  input:
    世帯:
      自分一覧:
        - 自分
    世帯員:
      自分:
        所得:
          "2023-06-01": 2000000
        誕生年月日: "1983-01-01"
  output:
    世帯:
      調整控除:
        "2023-06-01": 2500 # 人的控除額の差(50000) * 0.05

- name: 調整控除（控除後世帯高所得が2000000円以下、控除後世帯高所得が人的控除額の差未満）
  period: 2023-06-01
  input:
    世帯:
      自分一覧:
        - 自分
    世帯員:
      自分:
        所得:
          "2023-06-01": 440000 # 控除後世帯高所得は 440000 - 430000(基礎控除) = 10000
        誕生年月日: "1983-01-01"
  output:
    世帯:
      調整控除:
        "2023-06-01": 500 # 人的控除額の差(10000) * 0.05

- name: 調整控除（控除後世帯高所得が2000000円を超える）
  period: 2023-06-01
  input:
    世帯:
      自分一覧:
        - 自分
    世帯員:
      自分:
        所得:
          "2023-06-01": 2440000 # 控除後世帯高所得は 2440000 - 430000(基礎控除) = 2010000
        誕生年月日: "1983-01-01"
  output:
    世帯:
      調整控除:
        "2023-06-01": 2000 # (人的控除額の差(50000) - (控除後世帯高所得(2010000) - 2000000)) * 0.05

- name: 調整控除（調整控除の最小額は0円）
  period: 2023-06-01
  input:
    世帯:
      自分一覧:
        - 自分
    世帯員:
      自分:
        所得:
          "2023-06-01": 2500000 # 控除後世帯高所得は 2500000 - 430000(基礎控除) = 2070000
        誕生年月日: "1983-01-01"
  output:
    世帯:
      調整控除:
        "2023-06-01": 0 # (人的控除額の差(50000) - (控除後世帯高所得(2070000) - 2000000)) * 0.05 = -1000 だが0未満にはならない

# 控除後世帯高所得25000000円の境界値テストは省略（控除額が25000000円近くになるケースが存在しないため）

