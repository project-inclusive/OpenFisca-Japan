# 計算式が複雑なため、計算式に登場する各控除については決め打ちの値でテスト（各控除の算出についてはそれぞれの単体テストで担保）

# NOTE: 条件的に同時に受けられない控除があるためテストケース分割
- name: 人的控除額の差（差額通りの控除1）
  period: 2023-06-01
  input:
    世帯:
      親一覧:
        - 自分
        - 配偶者1
      子一覧:
        - 子1
    世帯員:
      自分:
        所得:
          '2023-06-01': 100000
        配偶者控除:
          '2023-06-01': 380000
        住民税配偶者控除:
          '2023-06-01': 330000 # 差額 50000
        障害者控除:
          '2023-06-01': 270000
        住民税障害者控除:
          '2023-06-01': 260000 # 差額 10000
        扶養控除:
          '2023-06-01': 380000
        住民税扶養控除:
          '2023-06-01': 330000 # 差額 50000
        誕生年月日: '1983-01-01'
      配偶者1:
        所得:
          '2023-06-01': 0
        誕生年月日: '1983-01-01'
      子1:
        所得:
          '2023-06-01': 10000
        勤労学生控除:
          '2023-06-01': 270000
        住民税勤労学生控除:
          '2023-06-01': 260000 # 差額 10000
        誕生年月日: '2023-01-01'
  output:
    世帯:
      人的控除額の差:
        '2023-06-01': 170000 # 所得税控除と住民税控除の差額(10000 + 10000 + 50000 + 50000) + 基礎控除の差額(50000)

- name: 人的控除額の差（差額通りの控除2）
  period: 2023-06-01
  input:
    世帯:
      親一覧:
        - 自分
        - 配偶者1
    世帯員:
      自分:
        所得:
          '2023-06-01': 1000000
        配偶者特別控除:
          '2023-06-01': 380000
        住民税配偶者特別控除:
          '2023-06-01': 330000 # 差額 50000
        誕生年月日: '1983-01-01'
      配偶者1:
        所得:
          '2023-06-01': 490000
        誕生年月日: '2023-01-01'
  output:
    世帯:
      人的控除額の差:
        '2023-06-01': 100000 # 所得税控除と住民税控除の差額(50000) + 基礎控除の差額(50000)

- name: 人的控除額の差（差額通りの控除3）
  period: 2023-06-01
  input:
    世帯:
      親一覧:
        - 自分
      子一覧:
        - 子1
    世帯員:
      自分:
        所得:
          '2023-06-01': 0
        寡婦控除:
          '2023-06-01': 270000
        住民税寡婦控除:
          '2023-06-01': 260000 # 差額 10000
        ひとり親控除:
          '2023-06-01': 350000
        住民税ひとり親控除:
          '2023-06-01': 300000 # 差額 50000
        誕生年月日: '1983-01-01'
      子1:
        所得:
          '2023-06-01': 0
        誕生年月日: '2023-01-01'
  output:
    世帯:
      人的控除額の差:
        '2023-06-01': 110000 # 所得税控除と住民税控除の差額(10000 + 50000) + 基礎控除の差額(50000)

# 例外的な計算式の場合

- name: 人的控除額の差(ひとり親、父親)
  period: 2023-06-01
  input:
    世帯:
      親一覧:
        - 自分
      子一覧:
        - 子1
    世帯員:
      自分:
        所得:
          '2023-06-01': 0
        性別:
          '2023-06-01': 男性
        ひとり親控除:
          '2023-06-01': 350000
        住民税ひとり親控除:
          '2023-06-01': 300000 # 差額 50000 (例外的に10000円で計算)
        誕生年月日: '1983-01-01'
      子1:
        所得:
          '2023-06-01': 0
        誕生年月日: '2023-01-01'
  output:
    世帯:
      人的控除額の差:
        '2023-06-01': 60000 # 所得税控除と住民税控除の差額(10000) + 基礎控除の差額(50000)

- name: 人的控除額の差（ひとり親、母親）
  period: 2023-06-01
  input:
    世帯:
      親一覧:
        - 自分
      子一覧:
        - 子1
    世帯員:
      自分:
        所得:
          '2023-06-01': 0
        寡婦控除:
          '2023-06-01': 270000
        住民税寡婦控除:
          '2023-06-01': 260000 # 差額 10000
        ひとり親控除:
          '2023-06-01': 350000
        住民税ひとり親控除:
          '2023-06-01': 300000 # 差額 50000
        性別:
          '2023-06-01': 女性
        誕生年月日: '1983-01-01'
      子1:
        所得:
          '2023-06-01': 0
        誕生年月日: '2023-01-01'
  output:
    世帯:
      人的控除額の差:
        '2023-06-01': 110000 # 所得税控除と住民税控除の差額(10000 + 50000) + 基礎控除の差額(50000)

- name: 人的控除額の差（基礎控除の差額が50000円扱い）
  period: 2023-06-01
  input:
    世帯:
      親一覧:
        - 自分
        - 配偶者1
    世帯員:
      自分:
        所得:
          '2023-06-01': 25000000
        誕生年月日: '1983-01-01'
      配偶者1:
        所得:
          '2023-06-01': 5000000
        誕生年月日: '1983-01-01'
  output:
    世帯:
      人的控除額の差:
        '2023-06-01': 50000 # 基礎控除の差額(50000)

- name: 人的控除額の差（基礎控除の差額が0円扱い）
  period: 2023-06-01
  input:
    世帯:
      親一覧:
        - 自分
        - 配偶者1
    世帯員:
      自分:
        所得:
          '2023-06-01': 25000002 # NOTE: float32の丸め誤差で 25000001円は25000000円になってしまう
        誕生年月日: '1983-01-01'
      配偶者1:
        所得:
          '2023-06-01': 5000000
        誕生年月日: '1983-01-01'
  output:
    世帯:
      人的控除額の差:
        '2023-06-01': 0

- name: 人的控除額の差 複数世帯（差額通りの控除1, 基礎控除の差額が50000円扱い）
  period: 2023-06-01
  input:
    世帯一覧:
      世帯1:
        親一覧:
          - 自分1
          - 配偶者1
        子一覧:
          - 子1
      世帯2:
        親一覧:
          - 自分2
          - 配偶者2
    世帯員:
      自分1:
        所得:
          '2023-06-01': 100000
        勤労学生控除:
          '2023-06-01': 270000
        住民税勤労学生控除:
          '2023-06-01': 260000 # 差額 10000
        配偶者控除:
          '2023-06-01': 380000
        住民税配偶者控除:
          '2023-06-01': 330000 # 差額 50000
        障害者控除:
          '2023-06-01': 270000
        住民税障害者控除:
          '2023-06-01': 260000 # 差額 10000
        扶養控除:
          '2023-06-01': 380000
        住民税扶養控除:
          '2023-06-01': 330000 # 差額 50000
        誕生年月日: '1983-01-01'
      配偶者1:
        所得:
          '2023-06-01': 0
        誕生年月日: '1983-01-01'
      子1:
        所得:
          '2023-06-01': 10000
        誕生年月日: '2023-01-01'
      自分2:
        所得:
          '2023-06-01': 25000000
        誕生年月日: '1983-01-01'
      配偶者2:
        所得:
          '2023-06-01': 5000000
        誕生年月日: '1983-01-01'
  output:
    世帯一覧:
      世帯1:
        人的控除額の差:
          '2023-06-01': 170000 # 所得税控除と住民税控除の差額(10000 + 10000 + 50000 + 50000) + 基礎控除の差額(50000)
      世帯2:
        人的控除額の差:
          '2023-06-01': 50000 # 基礎控除の差額(50000)

# 調整控除
- name: 調整控除（控除後世帯高所得が2000000円以下）
  period: 2023-06-01
  input:
    世帯:
      親一覧:
        - 自分
    世帯員:
      自分:
        所得:
          '2023-06-01': 2000000
        誕生年月日: '1983-01-01'
  output:
    世帯:
      調整控除:
        '2023-06-01': 2500 # 人的控除額の差(50000) * 0.05

- name: 調整控除（控除後世帯高所得が2000000円以下、控除後世帯高所得が人的控除額の差未満）
  period: 2023-06-01
  input:
    世帯:
      親一覧:
        - 自分
    世帯員:
      自分:
        所得:
          '2023-06-01': 440000 # 控除後世帯高所得は 440000 - 430000(基礎控除) = 10000
        誕生年月日: '1983-01-01'
  output:
    世帯:
      調整控除:
        '2023-06-01': 500 # 人的控除額の差(10000) * 0.05

- name: 調整控除（控除後世帯高所得が2000000円を超える）
  period: 2023-06-01
  input:
    世帯:
      親一覧:
        - 自分
    世帯員:
      自分:
        所得:
          '2023-06-01': 2440000 # 控除後世帯高所得は 2440000 - 430000(基礎控除) = 2010000
        誕生年月日: '1983-01-01'
  output:
    世帯:
      調整控除:
        '2023-06-01': 2000 # (人的控除額の差(50000) - (控除後世帯高所得(2010000) - 2000000)) * 0.05

- name: 調整控除（調整控除の最小額は0円）
  period: 2023-06-01
  input:
    世帯:
      親一覧:
        - 自分
    世帯員:
      自分:
        所得:
          '2023-06-01': 2500000 # 控除後世帯高所得は 2500000 - 430000(基礎控除) = 2070000
        誕生年月日: '1983-01-01'
  output:
    世帯:
      調整控除:
        '2023-06-01': 0 # (人的控除額の差(50000) - (控除後世帯高所得(2070000) - 2000000)) * 0.05 = -1000 だが0未満にはならない

# 控除後世帯高所得25000000円の境界値テストは省略（控除額が25000000円近くになるケースが存在しないため）

- name: 調整控除（複数世帯）
  period: 2023-06-01
  input:
    世帯一覧:
      世帯1:
        親一覧:
          - 親1_1
        子一覧:
          - 子1_1
      世帯2:
        親一覧:
          - 親2_1
          - 親2_2
    世帯員:
      親1_1:
        所得:
          '2023-06-01': 0
        ひとり親控除:
          '2023-06-01': 350000
        住民税ひとり親控除:
          '2023-06-01': 300000 # 差額 50000 (例外的に10000円で計算)
        性別:
          '2023-06-01': 男性
        誕生年月日: '1983-01-01'
      子1_1:
        所得:
          '2023-06-01': 0
        誕生年月日: '2023-01-01'
      親2_1:
        所得:
          '2023-06-01': 1000000
        配偶者特別控除:
          '2023-06-01': 380000
        住民税配偶者特別控除:
          '2023-06-01': 330000 # 差額 50000
        誕生年月日: '1983-01-01'
      親2_2:
        所得:
          '2023-06-01': 490000
        誕生年月日: '2023-01-01'
  output:
    世帯一覧:
      世帯1:
        人的控除額の差:
          '2023-06-01': 60000 # 所得税控除と住民税控除の差額(10000) + 基礎控除の差額(50000)
      世帯2:
        人的控除額の差:
          '2023-06-01': 100000 # 所得税控除と住民税控除の差額(50000) + 基礎控除の差額(50000)

- name: 調整控除（複数世帯, それぞれの世帯員数が異なる）
  period: 2023-06-01
  input:
    世帯一覧:
      世帯1:
        親一覧:
          - 親1_1
        子一覧:
          - 子1_1
      世帯2:
        親一覧:
          - 親2_1
    世帯員:
      親1_1:
        所得:
          '2023-06-01': 10000000
        誕生年月日: '1983-01-01'
      子1_1:
        誕生年月日: '2023-01-01'
      親2_1:
        所得:
          '2023-06-01': 2000000
        誕生年月日: '1983-01-01'
  output:
    世帯一覧:
      世帯1:
        調整控除:
          '2023-06-01': 0
      世帯2:
        調整控除:
          '2023-06-01': 2500
